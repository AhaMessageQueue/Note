## top

在系统维护的过程中，随时可能有需要查看 CPU 使用率，并根据相应信息分析系统状况的需要。在 CentOS 中，可以通过 top 命令来查看 CPU 使用状况。运行 top 命令后，CPU 使用状态会以全屏的方式显示，并且会处在对话的模式 -- 用基于 top 的命令，可以控制显示方式等等。退出 top 的命令为 q （在 top 运行中敲 q 键一次）。

top命令是Linux下常用的性能分析工具，能够实时显示系统中各个进程的资源占用状况，类似于Windows的任务管理器

可以直接使用`top`命令后，查看`%MEM`的内容。可以选择按进程查看或者按用户查看，如想查看oracle用户的进程内存使用情况的话可以使用如下的命令：

```
$ top -u root
```
```
top - 11:41:49 up 54 days, 19:14,  4 users,  load average: 3.64, 3.21, 3.10
Tasks: 134 total,   2 running, 126 sleeping,   6 stopped,   0 zombie
%Cpu(s): 87.1 us,  0.2 sy,  0.0 ni, 12.7 id,  0.0 wa,  0.0 hi,  0.1 si,  0.0 st
KiB Mem:   8176784 total,  7860480 used,   316304 free,   285000 buffers
KiB Swap:        0 total,        0 used,        0 free.  2615464 cached Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                               
13725 root      20   0 7269132 4.172g  16232 S 348.7 53.5  10177:43 java                                                                                                  
    7 root      20   0       0      0      0 S   0.3  0.0  47:03.17 rcu_sched                                                                                             
12846 root      20   0   23648   1644   1168 R   0.3  0.0   0:00.07 top                                                                                                   
    1 root      20   0   33352   2528   1304 S   0.0  0.0   0:01.35 init                                                                                                  
    2 root      20   0       0      0      0 S   0.0  0.0   0:00.60 kthreadd                                                                                              
    3 root      20   0       0      0      0 S   0.0  0.0   1:45.62 ksoftirqd/0                                                                                           
    5 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker/0:0H                                                                                          
    8 root      20   0       0      0      0 R   0.0  0.0  36:52.86 rcuos/0                                                                                               
    9 root      20   0       0      0      0 S   0.0  0.0   5:33.53 rcuos/1                                                                                               
   10 root      20   0       0      0      0 S   0.0  0.0   5:16.31 rcuos/2                                                                                               
   11 root      20   0       0      0      0 S   0.0  0.0   3:24.40 rcuos/3                                                                                               
   12 root      20   0       0      0      0 S   0.0  0.0   0:00.00 rcu_bh                                                                                                
   13 root      20   0       0      0      0 S   0.0  0.0   0:00.00 rcuob/0                                                                                               
   14 root      20   0       0      0      0 S   0.0  0.0   0:00.00 rcuob/1                                                                                               
   15 root      20   0       0      0      0 S   0.0  0.0   0:00.00 rcuob/2                                                                                               
   16 root      20   0       0      0      0 S   0.0  0.0   0:00.00 rcuob/3                                                                                               
   17 root      rt   0       0      0      0 S   0.0  0.0   0:25.26 migration/0                                                                                           
   18 root      rt   0       0      0      0 S   0.0  0.0   0:28.22 watchdog/0                                                                                            
   19 root      rt   0       0      0      0 S   0.0  0.0   0:20.54 watchdog/1                                                                                            
   20 root      rt   0       0      0      0 S   0.0  0.0   0:48.70 migration/1                                                                                           
   21 root      20   0       0      0      0 S   0.0  0.0   0:03.18 ksoftirqd/1                                                                                           
   23 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker/1:0H                                                                                          
   24 root      rt   0       0      0      0 S   0.0  0.0   0:23.57 watchdog/2                                                                                            
   25 root      rt   0       0      0      0 S   0.0  0.0   0:14.00 migration/2                                                                                           
   26 root      20   0       0      0      0 S   0.0  0.0   0:01.72 ksoftirqd/2           
```

### 内容解释
```
PID：进程的ID
USER：进程所有者
PR：进程的优先级别，越小越优先被执行
NI:nice值
VIRT：进程占用的虚拟内存
RES：进程占用的物理内存
SHR：进程使用的共享内存
S：进程的状态。S表示休眠，R表示正在运行，Z表示僵死状态，N表示该进程优先值为负数
%CPU：进程占用CPU的使用率
%MEM：进程使用的物理内存和总内存的百分比
TIME+：该进程启动后占用的总的CPU时间，即占用CPU使用时间的累加值。
COMMAND：进程启动命令名称
```

### 操作实例
在命令行中输入 `top`

即可启动 top

top 的全屏对话模式可分为3部分：系统信息栏、命令输入栏、进程列表栏。

第一部分 -- 最上部的 系统信息栏 ：
```
第一行（top）：
    “00:11:04”为系统当前时刻；
    “3:35”为系统启动后到现在的运作时间；
    “2 users”为当前登录到系统的用户，更确切的说是登录到用户的终端数 -- 同一个用户同一时间对系统多个终端的连接将被视为多个用户连接到系统，这里的用户数也将表现为终端的数目；
    “load average”为当前系统负载的平均值，后面的三个值分别为1分钟前、5分钟前、15分钟前进程的平均数，一般的可以认为这个数值超过 CPU 数目时，CPU 将比较吃力的负载当前系统所包含的进程；
第二行（Tasks）：
    “59 total”为当前系统进程总数；
    “1 running”为当前运行中的进程数；
    “58 sleeping”为当前处于等待状态中的进程数；
    “0 stoped”为被停止的系统进程数；
    “0 zombie”为僵尸进程数；
第三行（Cpus）：
    分别表示了 CPU 当前的使用率；
第四行（Mem）：
    分别表示了内存总量、当前使用量、空闲内存量、以及缓冲使用中的内存量；
第五行（Swap）：
    表示类别同第四行（Mem），但此处反映着交换分区（Swap）的使用情况。通常，交换分区（Swap）被频繁使用的情况，将被视作物理内存不足而造成的。
```
第二部分 -- 中间部分的内部命令提示栏：

top 运行中可以通过 top 的内部命令对进程的显示方式进行控制。内部命令如下表：

```
s - 改变画面更新频率
l - 关闭或开启第一部分第一行 top 信息的表示
t - 关闭或开启第一部分第二行 Tasks 和第三行 Cpus 信息的表示
m - 关闭或开启第一部分第四行 Mem 和 第五行 Swap 信息的表示
N - 以 PID 的大小的顺序排列表示进程列表
P - 以 CPU 占用率大小的顺序排列进程列表
M - 以内存占用率大小的顺序排列进程列表
h - 显示帮助
n - 设置在进程列表所显示进程的数量
q - 退出 top
```

第三部分 -- 最下部分的进程列表栏：

以 PID 区分的进程列表将根据所设定的画面更新时间定期的更新。通过 top 内部命令可以控制此处的显示方式

## pmap
可以根据进程查看进程相关信息占用的内存情况，(进程号可以通过ps查看)如下所示：
```
$ pmap -d 5647
```

